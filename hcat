#! /usr/bin/env python
#
# this script is provided under GPL v3 or upper

import sys

import pygments

from pygments.lexers import get_lexer_for_filename
from pygments import highlight
from pygments.formatters import Terminal256Formatter
from pygments.lexers import guess_lexer
from pygments.lexer import Lexer

def display(data, lexer):
    if lexer:
        print highlight(data, lexer, Terminal256Formatter())
    else:
        print(data)

def parse_stdin():
    f = sys.stdin
    data = f.read()
    try:
       lexer = guess_lexer(data)
    except pygments.util.ClassNotFound:
       lexer = None
    return data, lexer

if __name__ == '__main__':
    numbers_of_files = len(sys.argv) - 1
    if numbers_of_files:
        OFFSET = 1
        for i in range(numbers_of_files):
            filename = sys.argv[i + OFFSET]
            if filename == "-":
                data, lexer = parse_stdin()
            else:
                with open(filename) as f:
                    data = f.read()
                try:
                    lexer = get_lexer_for_filename(filename)
                except pygments.util.ClassNotFound:
                    try:
                        lexer = guess_lexer(data)
                    except pygments.util.ClassNotFound:
                        lexer = None
            display(data, lexer)
    else:
        data, lexer = parse_stdin()
        display(data, lexer)

